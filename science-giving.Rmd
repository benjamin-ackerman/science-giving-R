---
title: "Where do Scientists Put their Money in Politics?"
subtitle: "Analyzing Data from FiveThirtyEight's Blog"
author: "Benjamin Ackerman"
date: "February 18, 2018"
output: html_document
---

Since FiveThirtyEight recently [shared access to a lot of their data](https://data.fivethirtyeight.com), I thought it would be fun to download and analyze data from one of their blog posts in R.  I remember reading this article on [scientists' donations to political campaigns](https://fivethirtyeight.com/features/when-scientists-donate-to-politicians-its-usually-to-democrats/), and since the original blog post does not feature any visualizations, I thought I'd come up with some of my own.

Here are the packages I will be using:
```{r setup, echo=TRUE,results='hide', message=FALSE}
require(RCurl)
library(reshape)
library(dplyr)
library(ggplot2)
library(stringr)
library(rebus)
library(maps)
library(USAboundaries)
```

### Download and clean data from 538's website
```{r download and clean data,cache=TRUE}
link = "https://media.githubusercontent.com/media/fivethirtyeight/data/master/science-giving/science_federal_giving.csv"
data = read.csv(text = getURL(link),stringsAsFactors = FALSE)

### Clean up missingness in the data
data_cleaned = data %>% 
  mutate_all(funs(ifelse(. %in% c("","NULL"),NA,.)))
```

### Summarise donations to 2016 presidential candidates by science classification group
```{r presidential election donations, fig.align='center',fig.width = 10,fig.height = 8}
president_funding = data_cleaned %>% 
  mutate(transaction_amt = as.numeric(transaction_amt)) %>% 
  filter(cand_pty_affiliation %in% c("DEM","REP","LIB","IND"),
         cycle == "2016",
         cand_office == "P",
         cand_status == "C") %>% 
  group_by(state,cand_pty_affiliation,cand_name,classification) %>% 
  summarise(money = sum(transaction_amt,na.rm=TRUE))

### See the top 10 candidates who received funding from scientists by classification
top_10_funded = president_funding %>% 
  group_by(cand_name) %>% 
  summarise(total_donations = sum(money)) %>% 
  ungroup() %>% 
  top_n(10,wt = total_donations)

president_funding %>% 
  group_by(cand_name,classification) %>% 
  summarise(mon = sum(money)/1000000) %>% 
  right_join(top_10_funded,by="cand_name")%>%
  ggplot()+
    geom_bar(aes(x = reorder(cand_name,mon),y=mon,fill=classification),stat='identity') + 
    coord_flip() +
    scale_y_continuous(expand=c(0,0)) + 
    theme(legend.position = c(0.8, 0.15),legend.background = element_rect(fill="white")) +
    labs(title="Campaign Donations by Scientists to 2016 Presidential Candidates", x = "Presidential Candidate",y = "Total Donations Received ($, millions)")
```

### Visualize Differences in Scientists' Donations to Congressional Races in 2016
Here, I look at all records of scientists donating to congressional candidates from the 2016 election season.  I calculate the total dollars donated to Democrat and Republican candidates in each district, then look at the difference, to see where there is more money donated by scientists based on political party.  Districts that are darker blue reflect greater contributions to Democratic candidates, while districts that are darker red reflect greater contributions to Reblican candidates.  **Please note that this is all a work in progress.**
```{r congress races, fig.align = 'center'}
congress_map = us_congressional() %>% 
  mutate(cand_office_district = str_replace(cd115fp, START %R% "0",""),
         state_name = tolower(state_name)) %>% 
  dplyr::rename(cand_office_st = state_abbr) %>% 
  select(cand_office_st,cand_office_district,state_name,geometry)

congress_funding = data_cleaned %>% 
  mutate(transaction_amt = as.numeric(transaction_amt)) %>% 
  filter(cand_pty_affiliation %in% c("DEM","REP"),
         cycle == "2016",
         cand_office == "H",
         cand_status == "C")%>% 
  group_by(cand_office_st,cand_pty_affiliation,cand_office_district) %>% 
  summarise(money = sum(transaction_amt,na.rm=TRUE)) %>% 
  cast(cand_office_st + cand_office_district ~ cand_pty_affiliation, value="money") %>% 
  filter(!is.na(cand_office_district)) %>% 
  mutate_all(funs(ifelse(is.na(.),0,.))) %>% 
  mutate(party_diff = DEM - REP) %>% 
  right_join(congress_map,by=c("cand_office_st","cand_office_district"))


congress_donations <- function(region){
  if(region == "usa"){
    return(
      congress_funding %>% 
           filter(!cand_office_st %in% c("HI","AK")) %>% 
           ggplot() + 
              geom_sf(aes(fill=party_diff)) +
              scale_fill_gradient2("Donation Diffs ($)",low = "darkred", mid = "white", high = "darkblue")+
              theme_void()+
              theme(panel.grid.major = element_line(colour = "white"))+
              labs(title = "Partisan Differences in Scientist Donations to 2016 Congressional Races"))
  }
  else{
  return(
    congress_funding %>% 
      filter(state_name %in% region) %>% 
      ggplot() + 
        geom_sf(aes(fill=party_diff)) +
        scale_fill_gradient2("Donation Diffs ($)",low = "darkred", mid = "white", high = "darkblue") +
        theme_void() +
        theme(panel.grid.major = element_line(colour = "white")) +
        labs(title = paste0("Partisan Differences in Scientist Donations to 2016 Congressional Races in ",region)))}
}

congress_donations("usa")

congress_donations("texas")

congress_donations("new jersey")
```

